<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Working with Layers | Graphic Design with ggplot2</title>
  <meta name="description" content="Create Beautiful and Engaging Data Visualizations in R" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Working with Layers | Graphic Design with ggplot2" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Create Beautiful and Engaging Data Visualizations in R" />
  <meta name="github-repo" content="z3tt/graphic-design-ggplot2" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Working with Layers | Graphic Design with ggplot2" />
  
  <meta name="twitter:description" content="Create Beautiful and Engaging Data Visualizations in R" />
  

<meta name="author" content="Cédric Scherer" />


<meta name="date" content="2023-08-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tips-to-improve-your-ggplot-workflow.html"/>
<link rel="next" href="working-with-colors.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><b>“Graphic Design with ggplot2”</b><br>written by Cédric Scherer</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-read-this-book"><i class="fa fa-check"></i>Why Read This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-read-this-book"><i class="fa fa-check"></i>How to Read This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-information-and-conventions"><i class="fa fa-check"></i>Software Information and Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#communication"><i class="fa fa-check"></i><b>1.1</b> Communicating Data</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#coding"><i class="fa fa-check"></i><b>1.2</b> Coding Visualizations</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why"><i class="fa fa-check"></i><b>1.3</b> Why R and <strong>ggplot2</strong></a></li>
</ul></li>
<li class="part"><span><b>I General Overview</b></span></li>
<li class="chapter" data-level="2" data-path="grammar.html"><a href="grammar.html"><i class="fa fa-check"></i><b>2</b> The Layered Grammar of Graphics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="grammar.html"><a href="grammar.html#ggplot"><i class="fa fa-check"></i><b>2.1</b> The ggplot2 Package</a></li>
<li class="chapter" data-level="2.2" data-path="grammar.html"><a href="grammar.html#components"><i class="fa fa-check"></i><b>2.2</b> The Components of a ggplot</a></li>
<li class="chapter" data-level="2.3" data-path="grammar.html"><a href="grammar.html#key-components"><i class="fa fa-check"></i><b>2.3</b> Key Components</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="grammar.html"><a href="grammar.html#data"><i class="fa fa-check"></i><b>2.3.1</b> Data</a></li>
<li class="chapter" data-level="2.3.2" data-path="grammar.html"><a href="grammar.html#aesthetics"><i class="fa fa-check"></i><b>2.3.2</b> Aesthetics</a></li>
<li class="chapter" data-level="2.3.3" data-path="grammar.html"><a href="grammar.html#layers"><i class="fa fa-check"></i><b>2.3.3</b> Layers</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="grammar.html"><a href="grammar.html#additional-components"><i class="fa fa-check"></i><b>2.4</b> Additional Components</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="grammar.html"><a href="grammar.html#scales"><i class="fa fa-check"></i><b>2.4.1</b> Scales</a></li>
<li class="chapter" data-level="2.4.2" data-path="grammar.html"><a href="grammar.html#coords"><i class="fa fa-check"></i><b>2.4.2</b> Coordinate Systems</a></li>
<li class="chapter" data-level="2.4.3" data-path="grammar.html"><a href="grammar.html#facets"><i class="fa fa-check"></i><b>2.4.3</b> Facets</a></li>
<li class="chapter" data-level="2.4.4" data-path="grammar.html"><a href="grammar.html#themes"><i class="fa fa-check"></i><b>2.4.4</b> Themes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="get-started.html"><a href="get-started.html"><i class="fa fa-check"></i><b>3</b> Get Started</a>
<ul>
<li class="chapter" data-level="3.1" data-path="get-started.html"><a href="get-started.html#dataset"><i class="fa fa-check"></i><b>3.1</b> The Data Set</a></li>
<li class="chapter" data-level="3.2" data-path="get-started.html"><a href="get-started.html#rstats"><i class="fa fa-check"></i><b>3.2</b> Working in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="get-started.html"><a href="get-started.html#import"><i class="fa fa-check"></i><b>3.2.1</b> Import Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="get-started.html"><a href="get-started.html#workflows"><i class="fa fa-check"></i><b>3.2.2</b> Project-Oriented Workflows</a></li>
<li class="chapter" data-level="3.2.3" data-path="get-started.html"><a href="get-started.html#inspect"><i class="fa fa-check"></i><b>3.2.3</b> Inspect the Data</a></li>
<li class="chapter" data-level="3.2.4" data-path="get-started.html"><a href="get-started.html#classes"><i class="fa fa-check"></i><b>3.2.4</b> Data Types</a></li>
<li class="chapter" data-level="3.2.5" data-path="get-started.html"><a href="get-started.html#preparation"><i class="fa fa-check"></i><b>3.2.5</b> Data Preparation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>4</b> A Walk-Through Example</a>
<ul>
<li class="chapter" data-level="4.1" data-path="walkthrough.html"><a href="walkthrough.html#prep-ggplot"><i class="fa fa-check"></i><b>4.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.2" data-path="walkthrough.html"><a href="walkthrough.html#basics"><i class="fa fa-check"></i><b>4.2</b> Create a Basic ggplot</a></li>
<li class="chapter" data-level="4.3" data-path="walkthrough.html"><a href="walkthrough.html#combined-layers"><i class="fa fa-check"></i><b>4.3</b> Combine Multiple Layers</a></li>
<li class="chapter" data-level="4.4" data-path="walkthrough.html"><a href="walkthrough.html#map-aesthetics"><i class="fa fa-check"></i><b>4.4</b> Mapping Aesthetics</a></li>
<li class="chapter" data-level="4.5" data-path="walkthrough.html"><a href="walkthrough.html#set-properties"><i class="fa fa-check"></i><b>4.5</b> Setting Properties</a></li>
<li class="chapter" data-level="4.6" data-path="walkthrough.html"><a href="walkthrough.html#faceting"><i class="fa fa-check"></i><b>4.6</b> Create Small Multiples</a></li>
<li class="chapter" data-level="4.7" data-path="walkthrough.html"><a href="walkthrough.html#axis-scaling"><i class="fa fa-check"></i><b>4.7</b> Change the Axis Scaling</a></li>
<li class="chapter" data-level="4.8" data-path="walkthrough.html"><a href="walkthrough.html#color-scaling"><i class="fa fa-check"></i><b>4.8</b> Use a Custom Color Palette</a></li>
<li class="chapter" data-level="4.9" data-path="walkthrough.html"><a href="walkthrough.html#label-adjustment"><i class="fa fa-check"></i><b>4.9</b> Adjust Labels and Titles</a></li>
<li class="chapter" data-level="4.10" data-path="walkthrough.html"><a href="walkthrough.html#complete-themes"><i class="fa fa-check"></i><b>4.10</b> Apply a Complete Theme</a></li>
<li class="chapter" data-level="4.11" data-path="walkthrough.html"><a href="walkthrough.html#custom-theming"><i class="fa fa-check"></i><b>4.11</b> Customize the Theme</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html"><i class="fa fa-check"></i><b>5</b> Tips to Improve Your ggplot Design</a>
<ul>
<li class="chapter" data-level="5.1" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html#use-a-different-theme"><i class="fa fa-check"></i><b>5.1</b> Use a Different Theme</a></li>
<li class="chapter" data-level="5.2" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html#use-a-custom-font"><i class="fa fa-check"></i><b>5.2</b> Use a Custom Font</a></li>
<li class="chapter" data-level="5.3" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html#increase-the-font-sizes"><i class="fa fa-check"></i><b>5.3</b> Increase the Font Sizes</a></li>
<li class="chapter" data-level="5.4" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html#create-text-hierarchy"><i class="fa fa-check"></i><b>5.4</b> Create Text Hierarchy</a></li>
<li class="chapter" data-level="5.5" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html#modify-the-legend"><i class="fa fa-check"></i><b>5.5</b> Modify the Legend</a></li>
<li class="chapter" data-level="5.6" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html#align-titles-and-captions"><i class="fa fa-check"></i><b>5.6</b> Align Titles and Captions</a></li>
<li class="chapter" data-level="5.7" data-path="tips-to-improve-your-ggplot-design.html"><a href="tips-to-improve-your-ggplot-design.html#add-some-white-space"><i class="fa fa-check"></i><b>5.7</b> Add Some White Space</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tips-to-improve-your-ggplot-workflow.html"><a href="tips-to-improve-your-ggplot-workflow.html"><i class="fa fa-check"></i><b>6</b> Tips to Improve Your ggplot Workflow</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tips-to-improve-your-ggplot-workflow.html"><a href="tips-to-improve-your-ggplot-workflow.html#save-ggplot-output-with-the-correct-dimensions"><i class="fa fa-check"></i><b>6.1</b> Save ggplot Output with the “Correct” Dimensions</a></li>
<li class="chapter" data-level="6.2" data-path="tips-to-improve-your-ggplot-workflow.html"><a href="tips-to-improve-your-ggplot-workflow.html#display-ggplot-output-with-the-correct-dimensions"><i class="fa fa-check"></i><b>6.2</b> Display ggplot Output with the “Correct” Dimensions</a></li>
<li class="chapter" data-level="6.3" data-path="tips-to-improve-your-ggplot-workflow.html"><a href="tips-to-improve-your-ggplot-workflow.html#make-fonts-work"><i class="fa fa-check"></i><b>6.3</b> Make Fonts Work</a></li>
<li class="chapter" data-level="6.4" data-path="tips-to-improve-your-ggplot-workflow.html"><a href="tips-to-improve-your-ggplot-workflow.html#set-your-ggplot-theme-globally"><i class="fa fa-check"></i><b>6.4</b> Set Your ggplot Theme Globally</a></li>
<li class="chapter" data-level="6.5" data-path="tips-to-improve-your-ggplot-workflow.html"><a href="tips-to-improve-your-ggplot-workflow.html#automating-plots-batch-operations"><i class="fa fa-check"></i><b>6.5</b> Automating Plots: Batch Operations</a></li>
</ul></li>
<li class="part"><span><b>II How To Work with Components</b></span></li>
<li class="chapter" data-level="7" data-path="working-with-layers.html"><a href="working-with-layers.html"><i class="fa fa-check"></i><b>7</b> Working with Layers</a>
<ul>
<li class="chapter" data-level="7.1" data-path="working-with-layers.html"><a href="working-with-layers.html#predefined-layers"><i class="fa fa-check"></i><b>7.1</b> Predefined Layers</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="working-with-layers.html"><a href="working-with-layers.html#geometrical-versus-statistical-layers"><i class="fa fa-check"></i><b>7.1.1</b> Geometrical versus Statistical Layers</a></li>
<li class="chapter" data-level="7.1.2" data-path="working-with-layers.html"><a href="working-with-layers.html#layer-variants"><i class="fa fa-check"></i><b>7.1.2</b> Layer Variants</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="working-with-layers.html"><a href="working-with-layers.html#changing-layer-defaults"><i class="fa fa-check"></i><b>7.2</b> Changing Layer Defaults</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="working-with-layers.html"><a href="working-with-layers.html#positional-adjustments"><i class="fa fa-check"></i><b>7.2.1</b> Positional Adjustments</a></li>
<li class="chapter" data-level="7.2.2" data-path="working-with-layers.html"><a href="working-with-layers.html#modify-transformations-and-geometries"><i class="fa fa-check"></i><b>7.2.2</b> Modify Transformations and Geometries</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="working-with-layers.html"><a href="working-with-layers.html#positional-aesthetics"><i class="fa fa-check"></i><b>7.3</b> Positional Aesthetics</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="working-with-layers.html"><a href="working-with-layers.html#know-your-data-types"><i class="fa fa-check"></i><b>7.3.1</b> Know Your Data Types</a></li>
<li class="chapter" data-level="7.3.2" data-path="working-with-layers.html"><a href="working-with-layers.html#multiple-positional-aesthetics"><i class="fa fa-check"></i><b>7.3.2</b> Multiple Positional Aesthetics</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="working-with-layers.html"><a href="working-with-layers.html#statistical-summaries"><i class="fa fa-check"></i><b>7.4</b> Statistical Summaries</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="working-with-colors.html"><a href="working-with-colors.html"><i class="fa fa-check"></i><b>8</b> Working with Colors</a></li>
<li class="chapter" data-level="9" data-path="working-with-text.html"><a href="working-with-text.html"><i class="fa fa-check"></i><b>9</b> Working with Text</a></li>
<li class="chapter" data-level="10" data-path="working-with-themes.html"><a href="working-with-themes.html"><i class="fa fa-check"></i><b>10</b> Working with Themes</a>
<ul>
<li class="chapter" data-level="10.1" data-path="working-with-themes.html"><a href="working-with-themes.html#create-your-own-theme"><i class="fa fa-check"></i><b>10.1</b> Create Your Own Theme</a></li>
</ul></li>
<li class="part"><span><b>III Advanced Walk-Through Examples</b></span></li>
<li class="chapter" data-level="11" data-path="advanced-examples.html"><a href="advanced-examples.html"><i class="fa fa-check"></i><b>11</b> Overview</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="more-to-say.html"><a href="more-to-say.html"><i class="fa fa-check"></i><b>A</b> More to Say</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<hr class="grey"><li><i><a href="https://bookdown.org" target="blank">Published with bookdown</a></i></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Graphic Design with ggplot2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-layers" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Working with Layers<a href="working-with-layers.html#working-with-layers" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Layers represent the data in our visualizations, specifying the visual representation of variables such as points, lines, or bars. Internally all layers are created by the <code>layer()</code> function. A layer consists of</p>
<ul>
<li>the data set (<code>data</code>)</li>
<li>a mapping of variables to aesthetics (<code>mapping</code>)</li>
<li>a statistical transformation (<code>stat</code>)</li>
<li>a geometric representation (<code>geom</code>)</li>
<li>a positional adjustment (<code>position</code>)</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="working-with-layers.html#cb71-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb71-2"><a href="working-with-layers.html#cb71-2" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb71-3"><a href="working-with-layers.html#cb71-3" tabindex="-1"></a>    <span class="at">data =</span> bikes, </span>
<span id="cb71-4"><a href="working-with-layers.html#cb71-4" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> humidity),</span>
<span id="cb71-5"><a href="working-with-layers.html#cb71-5" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, </span>
<span id="cb71-6"><a href="working-with-layers.html#cb71-6" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, </span>
<span id="cb71-7"><a href="working-with-layers.html#cb71-7" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">&quot;identity&quot;</span></span>
<span id="cb71-8"><a href="working-with-layers.html#cb71-8" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerScatter"></span>
<img src="bookdown_files/figure-html/07layerScatter-1.png" alt="A simple scatter plot of humidty versus temperature created with the `layer()` function by passing the data, the positional aesthetic, a statistical transformation, a geomtric representatio n and the positional adjustment." width="864" />
<p class="caption">
FIGURE 7.1: A simple scatter plot of humidty versus temperature created with the <code>layer()</code> function by passing the data, the positional aesthetic, a statistical transformation, a geomtric representatio n and the positional adjustment.
</p>
</div>
<p>We map the variables of the specified data the positional aesthetics <code>x</code> and <code>y</code>. The data and aesthetic mappings are often specified in the initial <code>ggplot()</code> call. These specifications are then passed to all layers.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="working-with-layers.html#cb72-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> bikes, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> humidity)) <span class="sc">+</span></span>
<span id="cb72-2"><a href="working-with-layers.html#cb72-2" tabindex="-1"></a>  <span class="fu">layer</span>(<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p>Throughout the book, I am matching the argument names <code>data</code> and <code>mapping</code> in the initial <code>ggplot()</code> call implicitly: <code>ggplot(bikes, aes(x = temp, y = count))</code>. This is common practice and is used in many scripts, tutorials, and examples featuring <strong>ggplot2</strong> code.</p>
<div id="predefined-layers" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Predefined Layers<a href="working-with-layers.html#predefined-layers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To simplify your life, <strong>ggplot2</strong> features a long list of predefined individual layers with sensible default inputs for <code>geom</code>, <code>stat</code>, and <code>position</code>. Focusing on either the geometrical representation or the statistical transformation, these functions start with <code>geom_*()</code> or <code>stat_*()</code>.</p>
<div id="geometrical-versus-statistical-layers" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Geometrical versus Statistical Layers<a href="working-with-layers.html#geometrical-versus-statistical-layers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For all geometries and statistical transformation there are respective <code>geom_*()</code> and <code>stat_*()</code> functions. This means, you can usually go both routes to create the same chart. The following codes produce the same output as the <code>layer()</code> function above, a scatter plot of humidity versus temperature:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="working-with-layers.html#cb73-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> humidity)) <span class="sc">+</span></span>
<span id="cb73-2"><a href="working-with-layers.html#cb73-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="do">## with `stat = &quot;identity&quot;, position = &quot;identity&quot;`</span></span>
<span id="cb73-3"><a href="working-with-layers.html#cb73-3" tabindex="-1"></a></span>
<span id="cb73-4"><a href="working-with-layers.html#cb73-4" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> humidity)) <span class="sc">+</span></span>
<span id="cb73-5"><a href="working-with-layers.html#cb73-5" tabindex="-1"></a>  <span class="fu">stat_identity</span>() <span class="do">## with `geom = &quot;point&quot;, position = &quot;identity&quot;`</span></span></code></pre></div>
<p>Similarly, <code>geom_bar()</code> and <code>stat_count()</code> produce a <em>bar</em> chart with the height encoding the <em>count</em> per variable. For both, the default positional adjustment is <code>"stack"</code>. Mapping a variable to the <code>fill</code> aesthetic thus creates stacked bar charts:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="working-with-layers.html#cb74-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">fill =</span> year)) <span class="sc">+</span> </span>
<span id="cb74-2"><a href="working-with-layers.html#cb74-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="do">## with `stat = &quot;count&quot;, position = &quot;stack&quot;`</span></span>
<span id="cb74-3"><a href="working-with-layers.html#cb74-3" tabindex="-1"></a></span>
<span id="cb74-4"><a href="working-with-layers.html#cb74-4" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">fill =</span> year)) <span class="sc">+</span> </span>
<span id="cb74-5"><a href="working-with-layers.html#cb74-5" tabindex="-1"></a>  <span class="fu">stat_count</span>() <span class="do">## with `geom = &quot;bar&quot;, position = &quot;stack&quot;`</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPredefinedDefaultBars"></span>
<img src="bookdown_files/figure-html/07layerPredefinedDefaultBars-1.png" alt="A stacked bar chart of the number of observations per weather type and time of the day, created with the predefined layers `geom_bar()` or `stat_count()`." width="864" />
<p class="caption">
FIGURE 7.2: A stacked bar chart of the number of observations per weather type and time of the day, created with the predefined layers <code>geom_bar()</code> or <code>stat_count()</code>.
</p>
</div>
<p>Maybe you have wondered at some point, why you can use <code>geom_smooth()</code> and <code>stat_smooth()</code> interchangeably to create a conditional smoothing? This is because both call the same underlying layer function with the default arguments: <code>stat = "smooth"</code> which computes the fitted line and <code>geom = "smooth"</code> which draws the line and ribbon to visualize the mean and standard error, respectively.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="working-with-layers.html#cb75-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> humidity)) <span class="sc">+</span> </span>
<span id="cb75-2"><a href="working-with-layers.html#cb75-2" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="do">## with `stat = &quot;smooth&quot;`</span></span>
<span id="cb75-3"><a href="working-with-layers.html#cb75-3" tabindex="-1"></a></span>
<span id="cb75-4"><a href="working-with-layers.html#cb75-4" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> humidity)) <span class="sc">+</span> </span>
<span id="cb75-5"><a href="working-with-layers.html#cb75-5" tabindex="-1"></a>  <span class="fu">stat_smooth</span>() <span class="do">## with `geom = &quot;smooth&quot;`</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPredefinedDefaultSmooth"></span>
<img src="bookdown_files/figure-html/07layerPredefinedDefaultSmooth-1.png" alt="A conditional smoothing of humidity and temperature created with the predefined layers `geom_smooth()` or `stat_smooth()`." width="864" />
<p class="caption">
FIGURE 7.3: A conditional smoothing of humidity and temperature created with the predefined layers <code>geom_smooth()</code> or <code>stat_smooth()</code>.
</p>
</div>
</div>
<div id="layer-variants" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Layer Variants<a href="working-with-layers.html#layer-variants" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some predefined layers just have subtle differences to accommodate different use cases. For example, you can connect points either in the order of the x variable as a <em>line graph</em> or <em>time series chart</em> (<code>geom_line()</code>) using the shortest path or as a <em>stairstep plot</em> (<code>geom_step()</code>). Alternatively, you can connect the observations in order they appear in the data object (<code>geom_path()</code>) which allows to draw <em>connected scatter plots</em> to visualize trajectories.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="working-with-layers.html#cb76-1" tabindex="-1"></a>bikes_jul15 <span class="ot">&lt;-</span> bikes <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="working-with-layers.html#cb76-2" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>, month <span class="sc">==</span> <span class="dv">7</span>, day_night <span class="sc">==</span> <span class="st">&quot;day&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb76-3"><a href="working-with-layers.html#cb76-3" tabindex="-1"></a>  <span class="fu">arrange</span>(weather_type)</span>
<span id="cb76-4"><a href="working-with-layers.html#cb76-4" tabindex="-1"></a></span>
<span id="cb76-5"><a href="working-with-layers.html#cb76-5" tabindex="-1"></a><span class="fu">ggplot</span>(bikes_jul15, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> temp, <span class="at">color =</span> date)) <span class="sc">+</span></span>
<span id="cb76-6"><a href="working-with-layers.html#cb76-6" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb76-7"><a href="working-with-layers.html#cb76-7" tabindex="-1"></a></span>
<span id="cb76-8"><a href="working-with-layers.html#cb76-8" tabindex="-1"></a><span class="fu">ggplot</span>(bikes_jul15, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> temp, <span class="at">color =</span> date)) <span class="sc">+</span></span>
<span id="cb76-9"><a href="working-with-layers.html#cb76-9" tabindex="-1"></a>  <span class="fu">geom_step</span>()</span>
<span id="cb76-10"><a href="working-with-layers.html#cb76-10" tabindex="-1"></a></span>
<span id="cb76-11"><a href="working-with-layers.html#cb76-11" tabindex="-1"></a><span class="fu">ggplot</span>(bikes_jul15, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> temp, <span class="at">color =</span> date)) <span class="sc">+</span></span>
<span id="cb76-12"><a href="working-with-layers.html#cb76-12" tabindex="-1"></a>  <span class="fu">geom_path</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPredefinedDefaultVariants"></span>
<img src="bookdown_files/figure-html/07layerPredefinedDefaultVariants-1.png" alt="The three plots illustrate the different predefined geometrical layers that can be used to draw lines between observations. The colored dots illustrate the order in which the observations have been connected. While `geom_line()` (left) and `geom_step()` (middle) connect the points in order of the x axis, `geom_path()` (right) respects the order of the data and thus allows to move &quot;back&quot; on the x axis." width="864" />
<p class="caption">
FIGURE 7.4: The three plots illustrate the different predefined geometrical layers that can be used to draw lines between observations. The colored dots illustrate the order in which the observations have been connected. While <code>geom_line()</code> (left) and <code>geom_step()</code> (middle) connect the points in order of the x axis, <code>geom_path()</code> (right) respects the order of the data and thus allows to move “back” on the x axis.
</p>
</div>
<p>Other exemplary variants of geometrical layers are:</p>
<ul>
<li><strong><code>geom_point()</code> and <code>geom_jitter()</code></strong> – When used with one qualitative positional variable, jittering allows to avoid overplotting by adding random noise along the qualitative axis (see next chapter).</li>
<li><strong><code>geom_bar()</code> and <code>geom_col()</code></strong> – <code>geom_bar()</code> creates bars that represent the count or frequency of different categories in the data (only <code>x</code> or <code>y</code>) while <code>geom_col()</code> can be used to scale the height based on a quantitative variable (<code>x</code> and <code>y</code>).</li>
<li><strong><code>geom_density2d()</code> and <code>geom_density2d_filled()</code></strong> – Both layers compute smooth 2D density estimates, one representing the result as contour lines and the other as filled areas.</li>
</ul>
</div>
</div>
<div id="changing-layer-defaults" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Changing Layer Defaults<a href="working-with-layers.html#changing-layer-defaults" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The settings of the predefined layers are chosen with care. However, sometimes one needs to adjust the argument inputs of a layer to adjust its behavior. In the following we explore how we can make use of customizing the <code>geom</code>, <code>stat</code>, and <code>position</code>.</p>
<div id="positional-adjustments" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Positional Adjustments<a href="working-with-layers.html#positional-adjustments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While the stacked bars shown in Fig. <a href="working-with-layers.html#fig:07layerPredefinedDefaultBars">7.2</a> emphasize the total counts per weather type, a grouped bar chart simplifies comparison between groups. To change the default behavior of <code>geom_bar()</code> or <code>stat_count()</code>, which use <code>position = "stack"</code> as default, we set the <code>position</code> to <code>"dodge"</code>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="working-with-layers.html#cb77-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">fill =</span> day_night)) <span class="sc">+</span></span>
<span id="cb77-2"><a href="working-with-layers.html#cb77-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPredefinedCustomBars"></span>
<img src="bookdown_files/figure-html/07layerPredefinedCustomBars-1.png" alt="The bar chart of weather types per time of the day as dodged bars by setting the `position` to `&quot;dodge&quot;`, overwriting the default `&quot;stack&quot;`." width="864" />
<p class="caption">
FIGURE 7.5: The bar chart of weather types per time of the day as dodged bars by setting the <code>position</code> to <code>"dodge"</code>, overwriting the default <code>"stack"</code>.
</p>
</div>
<p>The quoted <code>"dodge"</code> is a shortcut to the function <code>position_dodge()</code>. If you want to adjust the default dodge behavior, you can specify arguments passed to the position function. For example, we might want to display all bars with the same width, independent of the presence of day and night (i.e. there is only one, very wide bar for snowfall as there are only day observations). We can fix this by passing <code>preserve = "single"</code> to the <code>position_dodge()</code> function. While this places the snowfall bar on the left, <code>position_dodge2()</code> centers it. At the same time, it adds some spacing between grouped bars when decreasing the bar width:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="working-with-layers.html#cb78-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">fill =</span> day_night)) <span class="sc">+</span></span>
<span id="cb78-2"><a href="working-with-layers.html#cb78-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb78-3"><a href="working-with-layers.html#cb78-3" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">7</span>, <span class="do">## more narrow bars</span></span>
<span id="cb78-4"><a href="working-with-layers.html#cb78-4" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(</span>
<span id="cb78-5"><a href="working-with-layers.html#cb78-5" tabindex="-1"></a>      <span class="at">preserve =</span> <span class="st">&quot;single&quot;</span> <span class="do">## consistent bar width</span></span>
<span id="cb78-6"><a href="working-with-layers.html#cb78-6" tabindex="-1"></a>    )</span>
<span id="cb78-7"><a href="working-with-layers.html#cb78-7" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPredefinedCustomBarsDodgeVars"></span>
<img src="bookdown_files/figure-html/07layerPredefinedCustomBarsDodgeVars-1.png" alt="The bar chart of weather types per time of the day as dodged bars by setting the `position` to `&quot;dodge&quot;`, overwriting the default `&quot;stack&quot;`." width="864" />
<p class="caption">
FIGURE 7.6: The bar chart of weather types per time of the day as dodged bars by setting the <code>position</code> to <code>"dodge"</code>, overwriting the default <code>"stack"</code>.
</p>
</div>
<p>Another common use case of positional adjustments is the so-called <em>jittering</em> of points by adding random noise to the qualitative axis. It is a simple approach to deal with overplotting in case of dot strip plots:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="working-with-layers.html#cb79-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb79-2"><a href="working-with-layers.html#cb79-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>, <span class="at">alpha =</span> .<span class="dv">3</span>)</span>
<span id="cb79-3"><a href="working-with-layers.html#cb79-3" tabindex="-1"></a></span>
<span id="cb79-4"><a href="working-with-layers.html#cb79-4" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb79-5"><a href="working-with-layers.html#cb79-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">3</span>), <span class="at">alpha =</span> .<span class="dv">3</span>)</span>
<span id="cb79-6"><a href="working-with-layers.html#cb79-6" tabindex="-1"></a></span>
<span id="cb79-7"><a href="working-with-layers.html#cb79-7" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb79-8"><a href="working-with-layers.html#cb79-8" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-16"></span>
<img src="bookdown_files/figure-html/unnamed-chunk-16-1.png" alt="identity versus jitter" width="864" />
<p class="caption">
FIGURE 7.7: identity versus jitter
</p>
</div>
</div>
<div id="modify-transformations-and-geometries" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Modify Transformations and Geometries<a href="working-with-layers.html#modify-transformations-and-geometries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can also overwrite the default <code>stat</code> in geometrical layers or the default <code>geom</code> in statistical layers. For example, changing the <code>geom</code> in <code>stat_smooth()</code> to <code>pointrange</code> turns the smoothed line and ribbon in Fig. <a href="working-with-layers.html#fig:07layerPredefinedDefaultSmooth">7.3</a> into points with vertical lines representing the confidence intervals:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="working-with-layers.html#cb80-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> wind_speed, <span class="at">y =</span> humidity)) <span class="sc">+</span></span>
<span id="cb80-2"><a href="working-with-layers.html#cb80-2" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">geom =</span> <span class="st">&quot;pointrange&quot;</span>)</span></code></pre></div>
<p>Again, we could rewrite the code by using the respective geometrical layer <code>geom_pointrange()</code> and setting the default statistical transformation <code>"identity"</code> to <code>"smooth"</code>.</p>
<div class="figure"><span style="display:block;" id="fig:07layerPredefinedCustomSmooth"></span>
<img src="bookdown_files/figure-html/07layerPredefinedCustomSmooth-1.png" alt="The conditional smoothing as so-called pointranges displaying the predicted mean as points and the confidence intervals as vertical lines by overwriting the default `geom` in `stat_smooth()` or using the respective geometrical layer with `stat = &quot;smooth&quot;`." width="864" />
<p class="caption">
FIGURE 7.8: The conditional smoothing as so-called pointranges displaying the predicted mean as points and the confidence intervals as vertical lines by overwriting the default <code>geom</code> in <code>stat_smooth()</code> or using the respective geometrical layer with <code>stat = "smooth"</code>.
</p>
</div>
<p>As you have already learned, <code>geom_point()</code> is usually used to draw scatter plots or dot strip plots showing the raw data. By replacing the default (non-)transformation <code>"identity"</code> with <code>"count"</code>, we can draw the overall count per group. In the following example, the points encode the counts per period of the day (<code>color = day_night</code>) and weather type (<code>x = weather_type</code>). The resulting plot is an alternative to the bar graph in Fig. <a href="working-with-layers.html#fig:07layerPredefinedDefaultBars">7.2</a> and Fig. <a href="working-with-layers.html#fig:07layerPredefinedCustomBars">7.5</a> and could be as well created by overwriting the default <code>geom = "bar"</code> with <code>geom = "point"</code>. Note that in that case we also need to adjust the <code>position</code>, the counts are stacked otherwise!</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="working-with-layers.html#cb81-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">color =</span> day_night)) <span class="sc">+</span></span>
<span id="cb81-2"><a href="working-with-layers.html#cb81-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat =</span> <span class="st">&quot;count&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb81-3"><a href="working-with-layers.html#cb81-3" tabindex="-1"></a></span>
<span id="cb81-4"><a href="working-with-layers.html#cb81-4" tabindex="-1"></a><span class="do">## this leads to &quot;wrong&quot; results as counts are cumulative (stacked)</span></span>
<span id="cb81-5"><a href="working-with-layers.html#cb81-5" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">color =</span> day_night)) <span class="sc">+</span></span>
<span id="cb81-6"><a href="working-with-layers.html#cb81-6" tabindex="-1"></a>  <span class="fu">stat_count</span>(<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb81-7"><a href="working-with-layers.html#cb81-7" tabindex="-1"></a></span>
<span id="cb81-8"><a href="working-with-layers.html#cb81-8" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">color =</span> day_night)) <span class="sc">+</span></span>
<span id="cb81-9"><a href="working-with-layers.html#cb81-9" tabindex="-1"></a>  <span class="fu">stat_count</span>(<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPredefinedCustomPointsCount"></span>
<img src="bookdown_files/figure-html/07layerPredefinedCustomPointsCount-1.png" alt="By overwriting the default stat method of `geom_point()` with `&quot;count&quot;`, we can alter its behaviour to calculate counts per group before plotting the data." width="864" />
<p class="caption">
FIGURE 7.9: By overwriting the default stat method of <code>geom_point()</code> with <code>"count"</code>, we can alter its behaviour to calculate counts per group before plotting the data.
</p>
</div>
</div>
</div>
<div id="positional-aesthetics" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Positional Aesthetics<a href="working-with-layers.html#positional-aesthetics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many geometrical shapes work with one or two positional arguments, namely <code>x</code> and/or <code>y</code>, to represent your data. Some other geometries need more positional arguments to be drawn, such as corner points of rectangles or start and end coordinates of segments and curves. The data type of the positional variables influences the selection and behavior of geometrical layers.</p>
<div id="know-your-data-types" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Know Your Data Types<a href="working-with-layers.html#know-your-data-types" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>geom_point()</code> is a versatile geometry that works with all combinations of quantitative and qualitative data mapped to <code>x</code> and <code>y</code>. When passing two qualitative variables, it creates a scatter plot as in Fig. <a href="working-with-layers.html#fig:07layerScatter">7.1</a>. However, it can also be used to draw a dot strip plot when combining a quantitative and a qualitative variable (cf. Fig. <a href="working-with-layers.html#fig:07layerPredefinedCustomPointsCount">7.9</a>), or to draw a heat bubble matrix when using two qualitative variables with the point size being mapped to a numeric variable.</p>
<p>Other geometries expect a certain combination of variables. Mapping the wrong data type to positional aesthetics can lead to unexpected behavior or may even return an error. To highlight the importance of passing the correct data types, let’s consider two examples.</p>
<p>Box-and-whisker plots (or short “box plots”) summarize the distribution of quantitative data, usually across multiple categories. By adding <code>geom_boxplot()</code>, <strong>ggplot2</strong> will calculate a box plot for each category if the type is <code>character</code>, <code>logical</code>, or <code>factor</code> but only a single box plot otherwise:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="working-with-layers.html#cb82-1" tabindex="-1"></a><span class="do">## creates four boxplots as `season` is a factor</span></span>
<span id="cb82-2"><a href="working-with-layers.html#cb82-2" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb82-3"><a href="working-with-layers.html#cb82-3" tabindex="-1"></a></span>
<span id="cb82-4"><a href="working-with-layers.html#cb82-4" tabindex="-1"></a><span class="do">## creates two boxplots as `is_weekend` is logical</span></span>
<span id="cb82-5"><a href="working-with-layers.html#cb82-5" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> is_weekend, <span class="at">y =</span> count)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb82-6"><a href="working-with-layers.html#cb82-6" tabindex="-1"></a></span>
<span id="cb82-7"><a href="working-with-layers.html#cb82-7" tabindex="-1"></a><span class="do">## creates a single boxplot as `temp` is numeric</span></span>
<span id="cb82-8"><a href="working-with-layers.html#cb82-8" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> count)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerTypeBoxplot"></span>
<img src="bookdown_files/figure-html/07layerTypeBoxplot-1.png" alt="The number of indiviudal box-and-whisker plots created by`geom_boxplot()` depends on the type of variable mapped to `x`. In case of categorical variables such as `season` or `is_weekend`, the function creates as many boxplots as there are categories. For quantitative variables such as `temp`, only a single boxplot is calculated covering the complete numerical range." width="864" />
<p class="caption">
FIGURE 7.10: The number of indiviudal box-and-whisker plots created by<code>geom_boxplot()</code> depends on the type of variable mapped to <code>x</code>. In case of categorical variables such as <code>season</code> or <code>is_weekend</code>, the function creates as many boxplots as there are categories. For quantitative variables such as <code>temp</code>, only a single boxplot is calculated covering the complete numerical range.
</p>
</div>
<p>We can force <strong>ggplot2</strong> to group the quantitative variable into equal numerical ranges, so-called <em>bins</em>. One approach is using the <code>group</code> aesthetic. In our case, we can create bins with a width of 1°C by rounding the numbers to the next smallest integer:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="working-with-layers.html#cb83-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> count, <span class="at">group =</span> <span class="fu">floor</span>(temp))) <span class="sc">+</span> </span>
<span id="cb83-2"><a href="working-with-layers.html#cb83-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">varwidth =</span> <span class="cn">TRUE</span>) <span class="do">## box width is proportional to sample size</span></span></code></pre></div>
<p>We can also create groups by adjusting the variable mapped to x directly. To create bins with equal ranges, we wrap the variable inside <code>cut_interval()</code>. The corresponding <code>cut_number()</code> creates groups with equal number of observations (and potentially unequal ranges).</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="working-with-layers.html#cb84-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">cut_interval</span>(temp, <span class="dv">6</span>), <span class="at">y =</span> count)) <span class="sc">+</span> </span>
<span id="cb84-2"><a href="working-with-layers.html#cb84-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">varwidth =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-3"><a href="working-with-layers.html#cb84-3" tabindex="-1"></a></span>
<span id="cb84-4"><a href="working-with-layers.html#cb84-4" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">cut_number</span>(temp, <span class="dv">6</span>), <span class="at">y =</span> count)) <span class="sc">+</span> </span>
<span id="cb84-5"><a href="working-with-layers.html#cb84-5" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">varwidth =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPositionalTypeBoxplotCut2"></span>
<img src="bookdown_files/figure-html/07layerPositionalTypeBoxplotCut2-1.png" alt="Three different ways to discretize the numeric x variable, here `temp`, to create multiple box plots. The upper row makes use of the `group` aesthetic in combination with `floor(temp)` to create bins of a width of 1°C. The lower row uses the `cut_*()` functions discretize the numeric variable into categorical. Here, we create four groups with equal range (bins of approx. 7.35°C, left) and equal number of observations (right), respectively. In all plots, the box widths are proportional to the number of observations to highlight the resulting group sizes of the different approaches." width="864" />
<p class="caption">
FIGURE 7.11: Three different ways to discretize the numeric x variable, here <code>temp</code>, to create multiple box plots. The upper row makes use of the <code>group</code> aesthetic in combination with <code>floor(temp)</code> to create bins of a width of 1°C. The lower row uses the <code>cut_*()</code> functions discretize the numeric variable into categorical. Here, we create four groups with equal range (bins of approx. 7.35°C, left) and equal number of observations (right), respectively. In all plots, the box widths are proportional to the number of observations to highlight the resulting group sizes of the different approaches.
</p>
</div>
<p>Histograms show the distribution of numeric variables as binned bars. The corresponding <code>geom_histogram()</code> creates these <em>binned bars</em> with <code>stat = "bin"</code> and <code>geom = "bar"</code> for quantitative variable. But it fails when passing qualitative variables as calculation of bins across categories is not meaningful. In case of a qualitative x aesthetic, <code>geom_bar()</code> with the default <code>stat = "count"</code> creates the desired bar chart showing counts per category.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="working-with-layers.html#cb85-1" tabindex="-1"></a><span class="do">## works as `temp` is numeric</span></span>
<span id="cb85-2"><a href="working-with-layers.html#cb85-2" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span>
<span id="cb85-3"><a href="working-with-layers.html#cb85-3" tabindex="-1"></a></span>
<span id="cb85-4"><a href="working-with-layers.html#cb85-4" tabindex="-1"></a><span class="do">## fails as `is_weekend` is categorical</span></span>
<span id="cb85-5"><a href="working-with-layers.html#cb85-5" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> is_weekend)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span>
<span id="cb85-6"><a href="working-with-layers.html#cb85-6" tabindex="-1"></a><span class="co"># Error: `stat_bin()` requires a continuous x aesthetic</span></span>
<span id="cb85-7"><a href="working-with-layers.html#cb85-7" tabindex="-1"></a></span>
<span id="cb85-8"><a href="working-with-layers.html#cb85-8" tabindex="-1"></a><span class="do">## create bars with discrete x aesthetics</span></span>
<span id="cb85-9"><a href="working-with-layers.html#cb85-9" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> is_weekend)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:07layerPositionalTypeHistogram"></span>
<img src="bookdown_files/figure-html/07layerPositionalTypeHistogram-1.png" alt="A histogram bins a quantitative variable, showing counts of obersvations per group (left). As qualitative data is already grouped, a regular bar chart is used to display counts per category (right)." width="864" />
<p class="caption">
FIGURE 7.12: A histogram bins a quantitative variable, showing counts of obersvations per group (left). As qualitative data is already grouped, a regular bar chart is used to display counts per category (right).
</p>
</div>
</div>
<div id="multiple-positional-aesthetics" class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Multiple Positional Aesthetics<a href="working-with-layers.html#multiple-positional-aesthetics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Other geometries need more than two positional aesthetics. <code>geom_linerange()</code> draws horizontal or vertical lines based on <code>xmin</code> and <code>xmax</code> or <code>ymin</code> and <code>ymax</code>, respectively. Let’s load some stock data and show the change of opening versus closing price over time:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="working-with-layers.html#cb86-1" tabindex="-1"></a>coins <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">&quot;./data/crypto_cleaned.rds&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="working-with-layers.html#cb86-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2018</span>, month <span class="sc">%in%</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>, currency <span class="sc">==</span> <span class="st">&quot;litecoin&quot;</span>)</span>
<span id="cb86-3"><a href="working-with-layers.html#cb86-3" tabindex="-1"></a></span>
<span id="cb86-4"><a href="working-with-layers.html#cb86-4" tabindex="-1"></a><span class="fu">ggplot</span>(coins, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">ymin =</span> open, <span class="at">ymax =</span> close)) <span class="sc">+</span></span>
<span id="cb86-5"><a href="working-with-layers.html#cb86-5" tabindex="-1"></a>  <span class="fu">geom_linerange</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/07layerPositionalInputsLinerange-1.png" width="864" /></p>
<p>That’s great but in addition I would like to indicate the direction of change in daily prices. For that we can use <code>geom_segment()</code> which allows to add arrow heads to straight lines. The segments are not restricted to vertical or horizontal and thus take four positional arguments: <code>x</code> and <code>xend</code> as well as <code>y</code> and <code>yend</code>. For our use case, we map the same variable, namely <code>date</code>, to both x coordinates. We then can define the arrow to be drawn by passing the <code>arrow()</code> function to the <code>arrow</code> argument inside <code>geom_segement()</code>.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="working-with-layers.html#cb87-1" tabindex="-1"></a><span class="fu">ggplot</span>(coins, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">xend =</span> date, </span>
<span id="cb87-2"><a href="working-with-layers.html#cb87-2" tabindex="-1"></a>                  <span class="at">y =</span> open, <span class="at">yend =</span> close)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="working-with-layers.html#cb87-3" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb87-4"><a href="working-with-layers.html#cb87-4" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(</span>
<span id="cb87-5"><a href="working-with-layers.html#cb87-5" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>, <span class="do">## draw an triangle as arrow head </span></span>
<span id="cb87-6"><a href="working-with-layers.html#cb87-6" tabindex="-1"></a>      <span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">3</span>, <span class="st">&quot;lines&quot;</span>)) <span class="do">## size of the arrow head</span></span>
<span id="cb87-7"><a href="working-with-layers.html#cb87-7" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdown_files/figure-html/07layerPositionalInputsSegment-1.png" width="864" /></p>
<p>The geom <code>pointrange</code> (that we have also used in the smoothing example) needs four positional aesthetics as well: in addition to the <code>x</code> and <code>y</code> positions, we have to specify the range as well as either <code>xmin</code> and <code>xmax</code> or <code>ymin</code> and <code>ymax</code>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="working-with-layers.html#cb88-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb88-2"><a href="working-with-layers.html#cb88-2" tabindex="-1"></a>bikes_season <span class="ot">&lt;-</span> </span>
<span id="cb88-3"><a href="working-with-layers.html#cb88-3" tabindex="-1"></a>  bikes <span class="sc">|&gt;</span> </span>
<span id="cb88-4"><a href="working-with-layers.html#cb88-4" tabindex="-1"></a>  <span class="fu">group_by</span>(season) <span class="sc">|&gt;</span> </span>
<span id="cb88-5"><a href="working-with-layers.html#cb88-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">mean</span>(count), <span class="at">sd =</span> <span class="fu">sd</span>(count))</span>
<span id="cb88-6"><a href="working-with-layers.html#cb88-6" tabindex="-1"></a></span>
<span id="cb88-7"><a href="working-with-layers.html#cb88-7" tabindex="-1"></a><span class="fu">ggplot</span>(bikes_season, </span>
<span id="cb88-8"><a href="working-with-layers.html#cb88-8" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> n, <span class="at">ymin =</span> n <span class="sc">-</span> sd, <span class="at">ymax =</span> n <span class="sc">+</span> sd)) <span class="sc">+</span></span>
<span id="cb88-9"><a href="working-with-layers.html#cb88-9" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-23-1.png" width="864" /></p>
</div>
</div>
<div id="statistical-summaries" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Statistical Summaries<a href="working-with-layers.html#statistical-summaries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can also use <code>stat_summary()</code> and let <strong>ggplot2</strong> do the transformation of the raw data. By default, <code>stat_summary()</code> uses a <code>pointrange</code> geometry with the three positional aesthetics representing mean ± standard error.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="working-with-layers.html#cb89-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb89-2"><a href="working-with-layers.html#cb89-2" tabindex="-1"></a>  <span class="fu">stat_summary</span>()</span></code></pre></div>
<p>Passing a set of functions to the arguments <code>fun</code>, <code>fun.min</code> and <code>fun.max</code> we can modify the range:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="working-with-layers.html#cb90-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb90-2"><a href="working-with-layers.html#cb90-2" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb90-3"><a href="working-with-layers.html#cb90-3" tabindex="-1"></a>    <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb90-4"><a href="working-with-layers.html#cb90-4" tabindex="-1"></a>    <span class="at">fun.min =</span> <span class="cf">function</span>(y) <span class="fu">mean</span>(y) <span class="sc">-</span> <span class="fu">sd</span>(y), </span>
<span id="cb90-5"><a href="working-with-layers.html#cb90-5" tabindex="-1"></a>    <span class="at">fun.max =</span> <span class="cf">function</span>(y) <span class="fu">mean</span>(y) <span class="sc">+</span> <span class="fu">sd</span>(y)</span>
<span id="cb90-6"><a href="working-with-layers.html#cb90-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-26-1.png" width="864" /></p>
<p>Alternatively, a function that returns the required aesthetics can be specified as input for <code>fun.data</code>. As the function <code>mean_sdl()</code> computes the mean ± 2 times the standard deviation, we have to adjust the function argument <code>mult</code> as well. Either we pass it to the <code>fun.args</code> argument or specify it as function argument directly.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="working-with-layers.html#cb91-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb91-2"><a href="working-with-layers.html#cb91-2" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb91-3"><a href="working-with-layers.html#cb91-3" tabindex="-1"></a>    <span class="at">fun.data =</span> <span class="st">&quot;mean_sdl&quot;</span>, </span>
<span id="cb91-4"><a href="working-with-layers.html#cb91-4" tabindex="-1"></a>    <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>)</span>
<span id="cb91-5"><a href="working-with-layers.html#cb91-5" tabindex="-1"></a>  )</span>
<span id="cb91-6"><a href="working-with-layers.html#cb91-6" tabindex="-1"></a></span>
<span id="cb91-7"><a href="working-with-layers.html#cb91-7" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb91-8"><a href="working-with-layers.html#cb91-8" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb91-9"><a href="working-with-layers.html#cb91-9" tabindex="-1"></a>    <span class="at">fun.data =</span> <span class="cf">function</span>(y) <span class="fu">mean_sdl</span>(y, <span class="at">mult =</span> <span class="dv">1</span>)</span>
<span id="cb91-10"><a href="working-with-layers.html#cb91-10" tabindex="-1"></a>  )</span></code></pre></div>
<p>This seems to hard to remember? The nice thing is that all solutions are valid, just pick your favorite (and forget about the rest as long as there is no particular reason to use it).</p>
<p>Similarly, we can also overwrite the default geometry, for example to display the median count for each season by adding a red triangle:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="working-with-layers.html#cb92-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb92-2"><a href="working-with-layers.html#cb92-2" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb92-3"><a href="working-with-layers.html#cb92-3" tabindex="-1"></a>    <span class="at">fun.data =</span> <span class="cf">function</span>(y) <span class="fu">mean_sdl</span>(y, <span class="at">mult =</span> <span class="dv">1</span>)</span>
<span id="cb92-4"><a href="working-with-layers.html#cb92-4" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-5"><a href="working-with-layers.html#cb92-5" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb92-6"><a href="working-with-layers.html#cb92-6" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>,</span>
<span id="cb92-7"><a href="working-with-layers.html#cb92-7" tabindex="-1"></a>    <span class="at">fun =</span> <span class="st">&quot;median&quot;</span>,</span>
<span id="cb92-8"><a href="working-with-layers.html#cb92-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb92-9"><a href="working-with-layers.html#cb92-9" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">17</span>,</span>
<span id="cb92-10"><a href="working-with-layers.html#cb92-10" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb92-11"><a href="working-with-layers.html#cb92-11" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-28-1.png" width="864" /></p>
<p>The <code>stat_*()</code> functions and especially <code>stat_summary</code> are incredible powerful and often a neat way to create all kind of chart types. Let’s use a combination of summaries to draw a dumbbell chart of temperature ranges across months.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="working-with-layers.html#cb93-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">y =</span> month, <span class="at">x =</span> temp)) <span class="sc">+</span> </span>
<span id="cb93-2"><a href="working-with-layers.html#cb93-2" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb93-3"><a href="working-with-layers.html#cb93-3" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;linerange&quot;</span>,</span>
<span id="cb93-4"><a href="working-with-layers.html#cb93-4" tabindex="-1"></a>    <span class="at">fun.min =</span> <span class="st">&quot;min&quot;</span>,</span>
<span id="cb93-5"><a href="working-with-layers.html#cb93-5" tabindex="-1"></a>    <span class="at">fun.max =</span> <span class="st">&quot;max&quot;</span></span>
<span id="cb93-6"><a href="working-with-layers.html#cb93-6" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb93-7"><a href="working-with-layers.html#cb93-7" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb93-8"><a href="working-with-layers.html#cb93-8" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>,</span>
<span id="cb93-9"><a href="working-with-layers.html#cb93-9" tabindex="-1"></a>    <span class="at">fun =</span> <span class="st">&quot;range&quot;</span>,</span>
<span id="cb93-10"><a href="working-with-layers.html#cb93-10" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb93-11"><a href="working-with-layers.html#cb93-11" tabindex="-1"></a>  )</span></code></pre></div>
<p>We can also use <code>stat_summary()</code> to add the actual minimum and maximum values to our plot. The geom <code>text</code> in combination with the <code>label</code> aesthetic adds data-related labels.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="working-with-layers.html#cb94-1" tabindex="-1"></a><span class="fu">ggplot</span>(bikes, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> temp)) <span class="sc">+</span> </span>
<span id="cb94-2"><a href="working-with-layers.html#cb94-2" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb94-3"><a href="working-with-layers.html#cb94-3" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;linerange&quot;</span>,</span>
<span id="cb94-4"><a href="working-with-layers.html#cb94-4" tabindex="-1"></a>    <span class="at">fun.min =</span> <span class="st">&quot;min&quot;</span>,</span>
<span id="cb94-5"><a href="working-with-layers.html#cb94-5" tabindex="-1"></a>    <span class="at">fun.max =</span> <span class="st">&quot;max&quot;</span></span>
<span id="cb94-6"><a href="working-with-layers.html#cb94-6" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb94-7"><a href="working-with-layers.html#cb94-7" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb94-8"><a href="working-with-layers.html#cb94-8" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>,</span>
<span id="cb94-9"><a href="working-with-layers.html#cb94-9" tabindex="-1"></a>    <span class="at">fun =</span> <span class="st">&quot;range&quot;</span>,</span>
<span id="cb94-10"><a href="working-with-layers.html#cb94-10" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb94-11"><a href="working-with-layers.html#cb94-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb94-12"><a href="working-with-layers.html#cb94-12" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb94-13"><a href="working-with-layers.html#cb94-13" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb94-14"><a href="working-with-layers.html#cb94-14" tabindex="-1"></a>    <span class="at">fun =</span> <span class="st">&quot;range&quot;</span>,</span>
<span id="cb94-15"><a href="working-with-layers.html#cb94-15" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(y)),</span>
<span id="cb94-16"><a href="working-with-layers.html#cb94-16" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">5</span></span>
<span id="cb94-17"><a href="working-with-layers.html#cb94-17" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-31-1.png" width="864" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tips-to-improve-your-ggplot-workflow.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-colors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/07-working-with-layers.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown.pdf", "bookdown.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
